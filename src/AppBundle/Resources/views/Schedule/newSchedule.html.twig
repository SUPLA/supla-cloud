{% extends 'AppBundle::layout.html.twig' %}
{% block content %}
    <div class="container margin-top-30">
        <div class="row">
            <div class="col-xs-12">
                <h1 class="title">
                    {% trans %}Create New Schedule{% endtrans %}
                </h1>
            </div>
        </div>
        <div class="row margin-top-20" id="new-schedule-form">
            <div class="col-xs-12">
                <div class="form-group">
                    <label>{% trans %}Name{% endtrans %}</label>
                    <input type="text" class="form-control">
                </div>
                <div class="form-group">
                    <label>{% trans %}Tryb harmonogramu{% endtrans %}</label>
                    <div class="clearfix"></div>
                    <div class="btn-group btn-group-lg">
                        {% for mode, label in scheduleModes %}
                            <button class="btn btn-default"
                                    v-on:click="scheduleMode = '{{ mode }}'"
                                    v-bind:class="{'active btn-success': scheduleMode == '{{ mode }}'}">
                                {{ label }}
                            </button>
                        {% endfor %}
                    </div>
                </div>
                <div class="row" v-show="scheduleMode">
                    <div class="col-md-6">
                        <div class="well">
                            <h3>Kiedy?</h3>
                            {% for mode, label in scheduleModes %}
                                <div v-show="scheduleMode == '{{ mode }}'">
                                    {{ include("AppBundle:Schedule:modes/new-schedule-mode-#{mode}.html.twig") }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="well">
                            <h3>Akcja do wykonania</h3>
                            <div class="form-group">
                                <label>Lokalizacja</label>
                                <select class="selectpicker form-control" v-model="location"
                                        v-on:change="device=undefined; renderDropdowns()">
                                    <option disabled selected value> -- wybierz lokalizację --</option>
                                    <option v-for="loc in locations"
                                            v-bind:value="loc"
                                            v-bind:title="loc.name"
                                            v-bind:data-content="'<h4>' + loc.name + ' (ID' + loc.id + ')</h4><p>Urządzeń: ' + loc.devices.length + '</p>'">
                                        ${loc.name}
                                    </option>
                                </select>
                            </div>
                            <div class="form-group" v-if="location">
                                <label>Urządzenie</label>
                                <select class="selectpicker form-control" v-model="device"
                                        v-on:change="renderDropdowns()">
                                    <option disabled selected value> -- wybierz urządzenie --</option>
                                    <option v-for="device in location.devices"
                                            v-bind:value="device"
                                            v-bind:title="device.name"
                                            v-bind:data-content="'<h4>' + device.name + ' (ID' + device.id + ')</h4>'">
                                        ${device.id}
                                    </option>
                                </select>
                            </div>
                            <div class="form-group" v-if="device">
                                <label>Kanał</label>
                                <select class="selectpicker form-control" v-model="channel"
                                        v-on:change="renderDropdowns()">
                                    <option disabled selected value> -- wybierz kanał --</option>
                                    <option v-for="channel in device.channels"
                                            v-bind:value="channel"
                                            v-bind:title="channel.name"
                                            v-bind:data-content="'<img class=\'pull-right\' height=60 src=\'/assets/img/functions/' + channel.function + '.svg\'><h4>' + channel.name + '</h4><p>' + channel.caption + '</p>'">
                                        ${ channel.name }
                                    </option>
                                </select>
                            </div>
                            <div class="form-group" v-if="channel">
                                <label>Akcja do wykonania</label>
                                <select class="selectpicker form-control" v-model="action">
                                    <option disabled selected value> -- wybierz akcję --</option>
                                    <option v-for="action in channel.actions"
                                            v-bind:value="action"
                                            v-bind:title="action"
                                            v-bind:data-content="'<h4>' +  action + '</h4>'">${ action }
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success btn-lg pull-right" v-if="action">
                    <i class="pe-7s-plus"></i>
                    Dodaj
                </button>
            </div>
        </div>
    </div>
{% endblock %}

{% block styles %}
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.44/css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/css/bootstrap-select.min.css">
    <style type="text/css">
        .timepicker-picker {
            font-size: 3em;
        }
    </style>
{% endblock %}

{% block scripts %}
    <script>
        var locations = {{ locations|json_encode|raw }};
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.1.8/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.44/js/bootstrap-datetimepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/js/bootstrap-select.min.js"></script>
    <script src="{{ asset('assets/js/new-schedule-form.js') }}"></script>
{% endblock %}