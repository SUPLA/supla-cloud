{% extends 'AppBundle::layout.html.twig' %}
{% block content %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.1.8/vue.min.js"></script>
    <div class="container margin-top-30">
        <div class="row">
            <div class="col-xs-12">
                <h1 class="title">
                    {% trans %}Create New Schedule{% endtrans %}
                </h1>
            </div>
        </div>
        <div class="row margin-top-20" id="new-schedule-form">
            <div class="col-xs-12">
                <div class="form-group">
                    <label>{% trans %}Name{% endtrans %}</label>
                    <input type="text" class="form-control">
                </div>
                <div class="form-group">
                    <label>{% trans %}Tryb harmonogramu{% endtrans %}</label>
                    <div class="clearfix"></div>
                    <div class="btn-group btn-group-lg">
                        {% for mode, label in scheduleModes %}
                            <button class="btn btn-default"
                                    @click="chooseMode('{{ mode }}')"
                                    v-bind:class="{'active btn-success': scheduleMode == '{{ mode }}'}">
                                {{ label }}
                            </button>
                        {% endfor %}
                    </div>
                </div>
                <div class="row" v-show="scheduleMode">
                    <div class="col-md-6">
                        <div class="well">
                            <h3>Kiedy?</h3>
                            <div class="form-group">
                                {% for mode, label in scheduleModes %}
                                    <div v-if="scheduleMode == '{{ mode }}'">
                                        {{ include("AppBundle:Schedule:modes/new-schedule-mode-#{mode}.html.twig") }}
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="forum-group" v-if="nextRunDates.length > 0"
                                 v-bind:class="{opacity60: calculatingNextRunDates}">
                                <h4>Najbliższe wykonania</h4>
                                <div class="list-group">
                                    <div class="list-group-item" v-for="nextRunDate in nextRunDates">
                                        <span class="pull-right small text-muted">
                                            ${nextRunDate.fromNow}
                                        </span>
                                        ${nextRunDate.date}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="well">
                            <h3>Akcja do wykonania</h3>
                            <div class="form-group">
                                <label>Podmiot</label>
                                <select class="selectpicker form-control" data-live-search="true" v-model="channel">
                                    <option disabled selected value> -- wybierz kanał --</option>
                                    {% for channel in userChannels %}
                                        <option value="{{ channel.id }}"
                                                title="{{ channel.caption ?: channel.function|channelFunctionToString }} ({{ channel.ioDevice.location.caption }} / {{ channel.ioDevice.name }})"
                                                data-content="<img class='pull-right' height=60 src='{{ asset('assets/img/functions/') }}{{ channel.function }}.svg'><h4>{{ channel.caption ? channel.caption ~ " <span class='small text-muted'>(#{channel.function|channelFunctionToString})</span>" : (channel.function|channelFunctionToString) }}</h4><p>{{ channel.ioDevice.location.caption }} / {{ channel.ioDevice.name }}</p>">
                                            {{ channel.caption }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group text-center" v-if="channel">
                                <div class="btn-group">
                                    <button class="btn btn-default"
                                            @click="action = 1"
                                            v-bind:class="{'active btn-success': action == 1}">
                                        Włącz
                                    </button>
                                    <button class="btn btn-default"
                                            @click="action = 0"
                                            v-bind:class="{'active btn-success': action == 0}">
                                        Wyłącz
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-success btn-lg pull-right"
                                        v-bind:disabled="action == undefined || !nextRunDates.length || submitting"
                                        @click="submit()">
                                    <i class="pe-7s-plus"></i>
                                    Dodaj
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/clockpicker/0.0.7/bootstrap-clockpicker.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/css/bootstrap-select.min.css">
    <style type="text/css">
        .timepicker-picker {
            font-size: 3em;
        }

        .bootstrap-select li.active a {
            background: #A0FFA0 !important;
            color: inherit !important;
        }
    </style>
{% endblock %}

{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clockpicker/0.0.7/bootstrap-clockpicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/js/bootstrap-select.min.js"></script>
    <script>
        var BASE_URL = '{{ path('_homepage') }}';
        moment.locale('{{ app.request.locale }}');
    </script>
    <script src="{{ asset('assets/js/new-schedule-form.js') }}"></script>
{% endblock %}
